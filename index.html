<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KickStream - Live Streaming</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #ec4899;
            --dark-900: #0f172a;
            --dark-800: #1e293b;
            --dark-700: #334155;
            --dark-600: #475569;
            --gray-400: #94a3b8;
            --gray-300: #cbd5e1;
            --white: #ffffff;
            --red-500: #ef4444;
            --yellow-500: #f59e0b;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--dark-900), #0b1120);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 4.5rem;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }
        .logo-icon {
            width: 2.25rem;
            height: 2.25rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        .logo-text {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        .nav-links {
            display: none;
            gap: 1.5rem;
        }
        .nav-links a {
            color: var(--gray-400);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            position: relative;
            padding: 0.5rem 0;
        }
        .nav-links a:hover {
            color: var(--white);
        }
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.2s ease;
        }
        .nav-links a:hover::after {
            transform: scaleX(1);
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .search-btn, .signin-btn {
            background: rgba(30, 41, 59, 0.6);
            color: var(--white);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }
        .search-btn:hover, .signin-btn:hover {
            background: rgba(51, 65, 85, 0.8);
            border-color: rgba(139, 92, 246, 0.5);
        }
        .signin-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        .signin-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), #e11d74);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        .stream-player-container {
            margin-bottom: 2rem;
        }
        .stream-player {
            background: var(--dark-900);
            border-radius: 1.25rem;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(51, 65, 85, 0.2);
        }
        /* === NUEVO REPRODUCTOR ESTILOS === */
        .video-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1));
            border-radius: 0;
            overflow: hidden;
            cursor: pointer;
            user-select: none;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .video-placeholder {
            width: 100%;
            aspect-ratio: 16/9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(236, 72, 153, 0.05));
        }

        .center-play {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 15;
            pointer-events: auto;
            transition: opacity 0.22s ease, transform 0.22s ease;
            opacity: 1;
        }

        .center-play.hide {
            opacity: 0;
            pointer-events: none;
        }

        .play-icon {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;  
        }

        .play-icon i {
            font-size: 1.5rem;
            margin-left: 0.2rem;
            color: white;      
        }

        .video-placeholder p {
            color: var(--gray-400);
            font-size: 16px;
        }

        /* Video Controls */
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            padding: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-wrapper:hover .video-controls {
            opacity: 1;
        }

        /* === PROGRESS CONTAINER MEJORADO === */
        .progress-container {
            width: 100%;
            height: 6px;
            background-color: var(--dark-700);
            border-radius: 3px;
            margin-bottom: 12px;
            cursor: pointer;
            position: relative;
        }

        /* Buffer bar (solo para VOD) */
        .buffer-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            width: 0%;
            z-index: 1;
        }

        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 3px;
            width: 0%;
            z-index: 2;
            transition: width 0.03s linear;
        }

        /* Thumb y preview */
        .thumb {
            position: absolute;
            top: 50%;
            width: 12px;
            height: 12px;
            background: var(--white);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .preview-time {
            position: absolute;
            top: -26px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 6px;
            font-size: 12px;
            border-radius: 4px;
            transform: translateX(-50%);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            white-space: nowrap;
        }

        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .left-controls, .right-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            touch-action: manipulation;
        }

        .control-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .control-btn i {
            font-size: 16px;
        }

        .volume-container {
            display: flex;
            align-items: center;
            
        }

        .volume-slider {
            width: 0;
            opacity: 0;
            margin-left: 0;
            transition: width 0.28s ease, opacity 0.28s ease, margin-left 0.28s;
            background: rgba(255,255,255,0.12);
            height: 5px;
            border-radius: 2px;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--white);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--white);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .volume-container:hover .volume-slider,
        .volume-container:focus-within .volume-slider,
        .volume-container.open .volume-slider {
            width: 60px;
            opacity: 1;
            margin-left: 8px;
        }

        .time-display {
            font-size: 14px;
            color: var(--gray-300);
        }

        .badge-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-wrapper:hover .badge-container {
            opacity: 1;
        }

        .live-badge {
            position: absolute;
            top: 16px;
            left: 16px;
            background-color: var(--red-500);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        .quality-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
        }

        .go-live-btn {
            position: absolute;
            bottom: 60px;
            left: 16px;
            padding: 4px 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--white);
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--dark-700);
            border-radius: 4px;
            cursor: pointer;
            display: none;
            z-index: 20;
            transition: background 0.2s ease;
        }

        .go-live-btn:hover {
            background: rgba(0, 0, 0, 0.6);
        }

        .settings-container {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .settings-dropdown {
            position: absolute;
            bottom: 100%; 
            left: 50%; 
            transform: translateX(-50%); 
            background-color: var(--dark-800);
            border: 1px solid var(--dark-700);
            border-radius: 8px;
            padding: 8px;
            min-width: 120px;
            z-index: 10;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .settings-dropdown.active {
            opacity: 1;
            transform: translateX(-50%) translateY(-16px);
            pointer-events: auto;
        }

        .settings-title {
            font-size: 12px;
            color: var(--gray-400);
            margin-bottom: 8px;
            padding: 0 4px;
        }

        .quality-option {
            padding: 6px 8px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            color: var(--gray-300);
        }

        .quality-option:hover {
            background-color: var(--dark-700);
        }

        .quality-option.active {
            color: var(--primary);
        }

        /* === Loading Spinner === */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin-centered 1s linear infinite;
            z-index: 12;
            display: none;
        }

        @keyframes spin-centered {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        

        @media (max-width: 768px) {
            .control-btn {
                width: 32px;
                height: 32px;
            }
            .control-btn i {
                font-size: 15px;
            }
            .volume-container:hover .volume-slider,
            .volume-container:focus-within .volume-slider,
            .volume-container.open .volume-slider {
                width: 50px;
                height: 4px;
            }
            .volume-slider::-webkit-slider-thumb { width: 10px; height: 10px; }
            .volume-slider::-moz-range-thumb { width: 10px; height: 10px; }
            .time-display { font-size: 12px; }
            .video-controls { padding: 12px; }
            .progress-container { height: 4px; margin-bottom: 8px; }
            .settings-dropdown { min-width: 90px; padding: 6px; font-size: 13px; }
            .live-badge { font-size: 10px; padding: 2px 8px; }
            .quality-badge { font-size: 12px; padding: 4px 8px; }
            .preview-time {
                font-size: 11px; padding: 1px 5px; top: -24px; }
            .loading-spinner { width: 1.6rem; height: 1.6rem; border-width: 2.5px; }
        }

        @media (max-width: 480px) {
            .control-btn {
                width: 30px;
                height: 30px;
            }
            .control-btn i {
                font-size: 14px;
            }
            .volume-container:hover .volume-slider,
            .volume-container:focus-within .volume-slider,
            .volume-container.open .volume-slider {
                width: 42px;
                height: 3px;
            }
            .volume-slider::-webkit-slider-thumb { width: 8px; height: 8px; }
            .volume-slider::-moz-range-thumb { width: 8px; height: 8px; }
            .video-controls { padding: 8px; }
            .progress-container { height: 3px; margin-bottom: 8px; } 
            .settings-dropdown { min-width: 80px; padding: 5px; font-size: 12px; }
            .quality-option { font-size: 12px; padding: 4px 6px; }
            .preview-time { font-size: 10px; padding: 1px 4px; top: -22px; white-space: nowrap; }
            .thumb { width: 10px; height: 10px; }
            .loading-spinner { width: 1.4rem; height: 1.4rem; border-width: 2px; }
        }

        .video-wrapper:fullscreen,
        .video-wrapper:-webkit-full-screen {
            width: 100%;
            height: 100%;
            border-radius: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        .video-wrapper:fullscreen video,
        .video-wrapper:-webkit-full-screen video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .time-live {
            color: var(--red-500);
            font-weight: bold;
        }

        /* Mostrar controles al interactuar (sin romper hover) */
        .video-controls.user-interacted {
            opacity: 1;
        }

        /* Pero si el usuario hace hover, priorizar el hover */
        .video-wrapper:hover .video-controls.user-interacted {
            opacity: 1;
        }

        /* Y si NO hay hover y NO hay interacción, ocultar */
        .video-wrapper:not(:hover) .video-controls:not(.user-interacted) {
            opacity: 0;
        }

        /* === FIN NUEVO REPRODUCTOR ESTILOS === */

        .stream-info {
            padding: 1rem;
            background: linear-gradient(to bottom, rgba(15, 23, 42, 0.8), var(--dark-900));
        }
        .stream-header-new {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 0;
        }
        .channel-avatar-container {
            position: relative;
            flex-shrink: 0;
        }
        .channel-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--red-500);
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        .channel-avatar.offline {
            border-color: var(--gray-400) !important;
        }
        .live-badge-stream {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(calc(50% - 8px));
            background: var(--red-500);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 2px;            
            font-size: 0.7rem;
            font-weight: 700;
            border: 1px solid var(--dark-900);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        .channel-info {
            flex: 1;
            min-width: 0;
        }
        .channel-name-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.3rem;
        }
        .channel-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            margin-right: 0.5rem;
        }
        .verified-badge {
            display: inline-flex;   
            align-items: center;
            margin-bottom: -1px;
            vertical-align: middle;
        }
        .verified-icon {
            width: 15px;
            height: 15px;
            display: inline-block;
            vertical-align: middle;
        }
        .viewers-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray-400);
            font-size: 0.9rem;
            font-weight: 500;
            margin-left: auto;
        }
        .viewers-label {
            display: inline;
        }
        .stream-title-new {
            font-size: 1.1rem;
            color: white;
            margin-bottom: 0.65rem;
            font-weight: 700;
            line-height: 1.3;
        }
        .category-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .category-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            font-size: 0.95rem;
            font-weight: 500;
        }
        .tags-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .tags-container::-webkit-scrollbar {
            display: none;
        }
        .tag {
            background: rgba(139, 92, 246, 0.2);
            color: white;
            padding: 0.2rem 0.7rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .tabs-below-video {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1.5rem 0 0;
        }
        .simple-tab {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            padding: 1rem;
            flex: 1;           
            min-width:180px;
            max-width: 154px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }
        .simple-tab:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(139, 92, 246, 0.4);
            transform: translateY(-2px);
        }
        .simple-tab.active {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.2));
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
        }
        .tab-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            object-fit: cover;
        }
        .tab-avatar.offline {
            border-color: var(--gray-400) !important;
        }
        .tab-name {
            font-weight: 700;
            font-size: 0.95rem;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            color: var(--white);
        }
        .tab-viewers {
            color: var(--gray-400);
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }
        .tab-watch-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .tab-watch-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), #e11d74);
            transform: translateY(-1px);
        }
        .placeholder-player {
            background: linear-gradient(135deg, var(--dark-800), var(--dark-900));
            border-radius: 1.25rem;
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(51, 65, 85, 0.2);
        }
        .placeholder-content {
            text-align: center;
            color: var(--gray-400);
        }
        .placeholder-icon {
            width: 4rem;
            height: 4rem;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            border: 2px solid var(--primary);
        }
        .placeholder-icon i {
            font-size: 1.5rem;
            color: var(--primary);
        }
        .placeholder-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .loading-spinner-main {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin-rotate 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
 
        @media (max-width: 768px) {
            .header-container {
                padding: 0 1rem;
                height: 4rem;
            }
            .logo-icon {
                width: 2rem;
                height: 2rem;
            }
            .logo-text {
                font-size: 1.25rem;
            }
            .nav-links {
                display: none;
            }
            .header-actions {
                gap: 0.5rem;
            }
            .search-btn, .signin-btn {
                padding: 0.4rem 0.6rem;
                font-size: 0.8rem;
            }
            .main-container {
                padding: 1rem;
            }
            .channel-avatar {
                width: 50px;
                height: 50px;
            }
            .live-badge-stream {
                font-size: 0.6rem;
                padding: 0.2rem 0.4rem;
                bottom: 0;
                left: 50%;
                transform: translateX(-50%) translateY(calc(50% - 7px));
            }
            .channel-name {
                font-size: 1.25rem;
            }
            .stream-title-new {
                font-size: 1rem;
            }
            .stream-header-new {
                gap: 0.75rem;
            }
            .channel-name-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
            .viewers-info {
                margin-left: auto;
                margin-top: 0.5rem;
            }
            .simple-tab {
                min-width: 160px;
                padding: 0.8rem;
            }
            .tab-avatar {
                width: 55px;
                height: 55px;
            }
            .tab-name {
                font-size: 0.85rem;
            }
            .tab-viewers {
                font-size: 0.75rem;
            }
            .tab-watch-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
        }
        @media (max-width: 480px) {
            .header-container {
                height: 3.5rem;
            }
            .logo-icon {
                width: 1.75rem;
                height: 1.75rem;
            }
            .logo-text {
                font-size: 1.1rem;
            }
            .search-btn, .signin-btn {
                padding: 0.3rem 0.5rem;
                font-size: 0.75rem;
            }
            .channel-avatar {
                width: 50px;
                height: 50px;
            }
            .live-badge-stream {
                font-size: 0.55rem;
                padding: 0.15rem 0.35rem;
                bottom: 0;
                left: 50%;
                transform: translateX(-50%) translateY(calc(50% - 6px));
            }
            .channel-name {
                font-size: 1.1rem;
            }
            .stream-title-new {
                font-size: 0.95rem;
            }
            .stream-header-new {
                gap: 0.5rem;
            }
            .channel-name-container {
                flex-direction: row;
                align-items: center;
            }
            .viewers-info {
                margin-top: 0;
            }
            .viewers-label {
                display: none;
            }
            .simple-tab {
                min-width: 140px;
                padding: 0.7rem;
            }
            .tab-avatar {
                width: 50px;
                height: 50px;
            }
            .tab-name {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-bolt" style="color: white; font-size: 1.1rem;"></i>
                </div>
                <div class="logo-text">KickStream</div>
            </a>
            <nav class="nav-links">
                <a href="#"><i class="fas fa-home"></i> Home</a>
                <a href="#"><i class="fas fa-fire"></i> Browse</a>
                <a href="#"><i class="fas fa-list"></i> Categories</a>
                <a href="#"><i class="fas fa-calendar"></i> Schedule</a>
                <a href="#"><i class="fas fa-crown"></i> Partners</a>
            </nav>
            <div class="header-actions">
                <button class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="signin-btn">
                    <i class="fas fa-user"></i> Sign In
                </button>
            </div>
        </div>
    </header>
    <!-- Main Content -->
    <main class="main-container">
        <!-- Stream Player with tabs below -->
        <div class="stream-player-container">
            <div id="streamPlayer" class="stream-player">
                <!-- === REPRODUCTOR NUEVO (AJUSTADO PARA TU CÓDIGO) === -->
<div class="video-wrapper video-container" id="videoWrapper">
    <div class="video-placeholder" id="videoPlaceholder"></div>
    <video id="videoPlayer" width="100%" height="100%" preload="metadata" playsinline>
        Tu navegador no soporta el elemento video.
    </video>
    <div class="loading-spinner" id="loadingSpinner"></div>
    <div id="centerPlay" class="center-play" aria-hidden="true">
        <div class="play-icon center-play-icon">
            <i class="fas fa-play"></i>
        </div>
    </div>
    <div class="badge-container">
        <div class="live-badge" id="liveBadge">
            <div class="live-dot"></div>
            <span>LIVE</span>
        </div>
        <div class="quality-badge" id="qualityBadge">0p</div>
    </div>
    <div class="video-controls">
        <div class="go-live-btn" id="goLiveBtn">Go to Live</div>
        <div class="progress-container" id="progressContainer">
            <div class="buffer-bar" id="bufferBar"></div>
            <div class="progress-bar" id="progressBar"></div>
            <div class="thumb" id="thumb"></div>
            <div class="preview-time" id="previewTime">0:00</div>
        </div>
        <div class="controls-row">
            <div class="left-controls">
                <div class="control-btn" id="playBtn">
                    <i class="fas fa-play"></i>
                </div>
                <div class="volume-container" id="volumeContainer">
                    <div class="control-btn" id="muteBtn">
                        <i class="fas fa-volume-up"></i>
                    </div>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
            </div>
            <div class="right-controls">
                <div class="settings-container">
                    <div class="control-btn" id="settingsBtn">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="settings-dropdown" id="settingsDropdown">
                        <div class="settings-title">Quality</div>
                        <div class="quality-option active" data-quality="1080p">1080p</div>
                        <div class="quality-option" data-quality="720p">720p</div>
                        <div class="quality-option" data-quality="480p">480p</div>
                    </div>
                </div>
                <div class="control-btn" id="fullscreenBtn">
                    <i class="fas fa-expand"></i>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- === FIN REPRODUCTOR NUEVO === -->
                <div class="stream-info">
                    <div class="stream-header-new">
                        <div class="channel-avatar-container">
                            <img src="https://placehold.co/60x60/ff6b6b/ffffff?text=NG" alt="Channel Avatar" class="channel-avatar" id="channelAvatar">
                            <div class="live-badge-stream" id="liveBadgeStream">LIVE</div>
                        </div>
                        <div class="channel-info">
                            <div class="channel-name-container">
                                <h2 class="channel-name" id="channelName">Select a stream</h2>
                                <span class="verified-badge" id="verifiedBadge"></span>
                                <div class="viewers-info" id="viewersInfoContainer">
                                    <i class="fas fa-users"></i>
                                    <span id="streamViewersNew">0</span> <span class="viewers-label">viewers</span>
                                </div>
                            </div>
                            <p class="stream-title-new" id="streamTitleNew">Choose from the tabs below</p>
                            <div class="category-section">
                                <div class="category-item">
                                     <span id="streamCategoryNew">Categorys</span>
                                </div>
                            </div>
                            <div class="tags-container" id="tagsContainer"><span class="tag">Tags</span></div>
                            <div class="stream-meta-new">
                                <div class="meta-item">
                                 <div class="partner-badge" id="partnerBadgeNew" style="display: none;">
                                </div>   
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Simple tabs below video -->
            <div class="tabs-below-video" id="tabsBelowVideo">
                <!-- Tabs will be generated by JavaScript -->
            </div>
    </main>
   <script>
    // --- CONFIGURACIÓN ---
    const TARGET_STREAMERS = ["Maryblog", "ElGlogloking", "EmetSuki", "Emikukis", "ANTONIcraTV", "MATnarok2", "agusneta"];
    const SIMULATED_VIDEOS = {
        "Maryblog": "https://sae13.playlist.live-video.net/v1/playlist/CvgF-rJRT2QvlwCSm6aL-B6LhLRzuKkq5T_b36Wdo3eyj2zUMMQpg7R3B0h71Pe7FYBJiWZCQ7F87DQOb-XEV5s2x3qAkX8d-5zHDjGE4q2QQEnddMiZfSvuyJ2QJx_HzS4FHKWe8iBQq3odrOnewj45hEqGuLzo7CKPyk3pDPio6iFVAy1H6yxTSRAMmQsrIo1JQSZsAhcIyKW_ZeabMWIGr71Wt2Zt2Suut7cgeCw8Y4hwhLDcgqbyt8AW799CvVEBhYOiN6n4NGvbnVn8vgTc-aUhRcI36fomi2YsdwQbdJWxK9LUjD9YkAdtrBjOZWxcZ-uuuVa82-UiBY-VXmg5HieacgkHnrnOc6frzSXvA_ImCu3iBu3BBa0L5ZUyWsb5bfj53-O14LlcePNA9HqS44OYmswRMGpF4dXSOf2IQuHvphTGaHJfNp4yL0ZHKqKwKJLNofA4r7Vt1Dmp85KYyjUhzmYFyVs1VZ_rGYFuuDYX4-2_IosaZ8dqXRFHDgjiWikKhfbrgCrLf6tMNQjRlfyVhc0TtRrGx2PZuTWfjSSQQjXvQggI-2USdJ_b0JxOCc5MoosvE2wLWyzhnWxWbHmzXdQCqxH-UZaVmQw7dndgl2eJm1h1DDHtHJ5ZJo-JduJ_FW-AY8PAn48RXZmhuCdx1ReFd2SJsvSGLcmAYQdrNw6mdgUCk2UoZqUvwHX7tN9b-cQdTWf4ao2LSFo9hKaZIUJCkqmH00BWlKnzixPqouIpbaqNxYNlKnzxADiyOyY8do8BEDWCZ5IpRdpNzlQv08F10VP5UlU-fvTm8ofAANP16i2BXO-BcIs573oeTMzhEm5JvJMadX-CKvphgIT7ZSCH6E_TsTgtwE-e3KstQjKgMCF-43B_FE7IX2DYKpVezHrNKc67E0ICR_tF0hRcjX111AD3RTPZ0e7hebPvPMZW9jsW5o3ixw1JNmW1vekWFFrB3mQvu55dYdvM6Ab_9Gc0xkhtDUYyrOeTs60rZj3sXQv9YRoMHImODW7NanRY4-coIAEqCXVzLWVhc3QtMjCuDQ.m3u8",
        "ElGlogloking": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
        "EmetSuki": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
        "Emikukis": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4",
        "ANTONIcraTV": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4",
        "MATnarok2": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4",
        "agusneta": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
    };

    const KICK_VERIFIED_SVG = `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="verified-icon">
  <g clip-path="url(#clip0_614_6275)">
    <path d="M30.8598 19.2368C30.1977 18.2069 29.5356 17.2138 28.8736 16.1839C28.7264 15.9632 28.7264 15.8161 28.8736 15.5954C29.5356 14.6023 30.1609 13.6092 30.823 12.6161C31.5954 11.4391 31.1908 10.2989 29.8667 9.82069C28.7632 9.41609 27.6598 8.97471 26.5563 8.57012C26.3356 8.49656 26.2253 8.34943 26.2253 8.09196C26.1885 6.87816 26.1149 5.66437 26.0414 4.48736C25.9678 3.2 24.9747 2.46437 23.7241 2.7954C22.5471 3.08966 21.3701 3.42069 20.2299 3.75173C19.9724 3.82529 19.8253 3.75173 19.6414 3.56782C18.9057 2.61149 18.1333 1.69195 17.3977 0.772414C16.5885 -0.257472 15.3379 -0.257472 14.492 0.772414C13.7563 1.69195 12.9839 2.61149 12.2851 3.53103C12.1012 3.7885 11.9172 3.82529 11.623 3.75173C10.4828 3.42069 9.34253 3.12644 8.53334 2.90575C6.95173 2.53793 5.99541 3.16322 5.92184 4.48736C5.84828 5.70115 5.77472 6.91495 5.73794 8.16552C5.73794 8.42299 5.62759 8.53333 5.4069 8.64368C4.26667 9.08506 3.12644 9.52644 1.98621 9.96782C0.809203 10.446 0.441387 11.5862 1.14023 12.6529C1.8023 13.6828 2.46437 14.6759 3.12644 15.7057C3.27356 15.9264 3.27356 16.0736 3.12644 16.331C2.42759 17.3609 1.76552 18.3908 1.10345 19.4575C0.478165 20.4506 0.882759 21.6276 1.98621 22.069C3.12644 22.5104 4.30345 22.9517 5.44368 23.3931C5.70115 23.4667 5.77471 23.6138 5.77471 23.8713C5.81149 25.0483 5.95862 26.1885 5.95862 27.3655C5.95862 28.5425 6.9885 29.6092 8.42298 29.1678C9.56321 28.8 10.7034 28.5425 11.8437 28.2115C12.0644 28.1379 12.2115 28.1747 12.3586 28.3954C13.131 29.3517 13.8667 30.2713 14.6391 31.2276C15.485 32.2575 16.6988 32.2575 17.508 31.2276C18.2805 30.2713 19.0161 29.3517 19.7885 28.3954C19.9356 28.2115 20.046 28.1379 20.3034 28.2115C21.4804 28.5425 22.6575 28.8368 23.8345 29.1678C25.0483 29.4988 26.0781 28.7632 26.1149 27.5126C26.1885 26.2989 26.2621 25.0851 26.2988 23.8345C26.2988 23.5402 26.446 23.4299 26.6667 23.3563C27.7701 22.9517 28.9103 22.5104 30.0138 22.069C31.1908 21.4805 31.5586 20.3034 30.8598 19.2368ZM22.069 13.2046L14.7127 20.5609C14.5287 20.7448 14.2713 20.892 14.0138 20.9287C13.9402 20.9287 13.8299 20.9655 13.7563 20.9655C13.4253 20.9655 13.0575 20.8184 12.8 20.5609L9.78392 17.5448C9.26898 17.0299 9.26898 16.1839 9.78392 15.669C10.2989 15.154 11.1448 15.154 11.6598 15.669L13.7196 17.7287L20.1196 11.3287C20.6345 10.8138 21.4805 10.8138 21.9954 11.3287C22.5839 11.8437 22.5839 12.6897 22.069 13.2046Z" fill="url(#paint0_linear)"/>
  </g>
  <defs>
    <linearGradient id="paint0_linear" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
      <stop stop-color="#1EFF00"/>
      <stop offset="1" stop-color="#FFE99C"/>
    </linearGradient>
    <clipPath id="clip0_614_6275">
      <rect width="32" height="32" fill="white"/>
    </clipPath>
  </defs>
</svg>`;

    // --- DOM Elements ---
    const videoPlayer = document.getElementById('videoPlayer');
    const playBtn = document.getElementById('playBtn');
    const muteBtn = document.getElementById('muteBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const bufferBar = document.getElementById('bufferBar');
    const timeDisplay = document.getElementById('timeDisplay');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsDropdown = document.getElementById('settingsDropdown');
    const goLiveBtn = document.getElementById('goLiveBtn');
    const qualityBadge = document.getElementById('qualityBadge');
    const videoWrapper = document.getElementById('videoWrapper');
    const liveBadge = document.getElementById('liveBadge');
    const centerPlay = document.getElementById('centerPlay');
    const thumb = document.getElementById('thumb');
    const previewTime = document.getElementById('previewTime');
    const volumeContainer = document.getElementById('volumeContainer');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const videoPlaceholder = document.getElementById('videoPlaceholder');

    const channelAvatar = document.getElementById('channelAvatar');
    const channelName = document.getElementById('channelName');
    const verifiedBadge = document.getElementById('verifiedBadge');
    const streamTitleNew = document.getElementById('streamTitleNew');
    const streamCategoryNew = document.getElementById('streamCategoryNew');
    const streamViewersNew = document.getElementById('streamViewersNew');
    const partnerBadgeNew = document.getElementById('partnerBadgeNew');
    const tagsContainer = document.getElementById('tagsContainer');
    const tabsBelowVideo = document.getElementById('tabsBelowVideo');
    const liveBadgeStream = document.getElementById('liveBadgeStream');
    const viewersInfoContainer = document.getElementById('viewersInfoContainer');

    let currentStreamer = null;
    let hls = null;
    let isLiveDetected = false;
    let rafId = null;

    // --- UTILIDADES ---
    function formatViewers(count) {
        if (count >= 1000000) return (count / 1000000).toFixed(1) + 'M';
        if (count >= 1000) return (count / 1000).toFixed(1) + 'K';
        return count.toString();
    }
    function formatFollowers(count) {
        if (count >= 1000000) return (count / 1000000).toFixed(1) + 'M';
        if (count >= 1000) return (count / 1000).toFixed(1) + 'K';
        return count.toLocaleString();
    }

    async function getLastLiveText(username) {
        try {
            const res = await fetch(`https://kick.com/api/v1/channels/${username}`);
            if (!res.ok) return "No disponible";
            const data = await res.json();
            if (Array.isArray(data.previous_livestreams) && data.previous_livestreams.length > 0) {
                const last = data.previous_livestreams[0];
                const startMs = Date.parse((last.created_at || '') + "Z");
                const durMs = Number(last.duration);
                if (!isNaN(startMs) && !isNaN(durMs) && durMs > 0) {
                    const endMs = startMs + durMs;
                    const agoMs = Date.now() - endMs;
                    if (agoMs > 0) {
                        const totalSeconds = Math.floor(agoMs / 1000);
                        if (totalSeconds < 60) {
                            return "menos de un min";
                        }
                        const totalMinutes = Math.floor(totalSeconds / 60);
                        const totalHours = Math.floor(totalMinutes / 60);
                        const days = Math.floor(totalHours / 24);
                        const hours = totalHours % 24;
                        const minutes = totalMinutes % 60;
                        let parts = [];
                        if (days > 0) {
                            parts.push(`${days} día${days !== 1 ? 's' : ''}`);
                        }
                        if (hours > 0) {
                            parts.push(`${hours} h`);
                        }
                        if (minutes > 0 && days === 0) {
                            parts.push(`${minutes} min`);
                        }
                        if (parts.length === 0) {
                            return "menos de un min";
                        }
                        return `hace ${parts.join(' ')}`;
                    }
                }
            }
            return "Nunca ha estado en vivo";
        } catch (e) {
            console.warn(`Error al obtener último live de ${username}:`, e);
            return "No disponible";
        }
    }

    async function fetchStreamerData(username) {
        try {
            const res = await fetch(`https://kick.com/api/v2/channels/${username}`);
            if (!res.ok) return null;
            const data = await res.json();
            const rawTags = data.livestream?.tags || [];
            const tags = rawTags.map(t => typeof t === 'string' ? t : t.name || t).filter(Boolean);
            let isVerified = false;
            if (data?.user && typeof data.user.verified !== 'undefined') {
                isVerified = Boolean(data.user.verified);
            } else if (typeof data.verified !== 'undefined') {
                isVerified = Boolean(data.verified);
            } else if (data?.user && typeof data.user.is_verified !== 'undefined') {
                isVerified = Boolean(data.user.is_verified);
            }
            const lastLiveText = await getLastLiveText(username);
            return {
                id: data.id,
                name: data.user.username,
                followers: data.followers_count || 0,
                isLive: data.livestream?.is_live || false,
                isPartner: data.is_partner || false,
                isVerified: isVerified,
                avatar: data.user.profile_pic || `https://placehold.co/60x60/8b5cf6/ffffff?text=${username[0]}`,
                videoUrl: SIMULATED_VIDEOS[username] || Object.values(SIMULATED_VIDEOS)[0],
                streamTitle: data.livestream?.session_title || 'Sin título',
                category: data.livestream?.categories?.[0]?.name || 'Just Chatting',
                viewers: data.livestream?.viewer_count || 0,
                tags: tags.length ? tags : ['Live'],
                offlineBanner: data.offline_banner_image?.src || null,
                lastLiveText: lastLiveText
            };
        } catch (e) {
            console.warn(`Error al cargar ${username}:`, e);
            return null;
        }
    }

    async function renderTabsBelowVideo() {
        tabsBelowVideo.innerHTML = '<div class="loading-spinner-main"></div>';
        const promises = TARGET_STREAMERS.map(fetchStreamerData);
        const streamers = (await Promise.all(promises)).filter(Boolean);
        if (streamers.length === 0) {
            tabsBelowVideo.innerHTML = '<p style="color: var(--gray-400); text-align: center; width: 100%;">Error al cargar streamers</p>';
            return;
        }
        const onlineStreamers = streamers.filter(s => s.isLive);
        const offlineStreamers = streamers.filter(s => !s.isLive);
        const orderedStreamers = [...onlineStreamers, ...offlineStreamers];
        tabsBelowVideo.innerHTML = '';
        orderedStreamers.forEach(streamer => {
            const tab = document.createElement('div');
            tab.className = 'simple-tab';
            tab.dataset.streamerId = streamer.id;
            if (streamer.isLive) {
                tab.innerHTML = `
                    <img src="${streamer.avatar}" alt="${streamer.name}" class="tab-avatar">
                    <div class="tab-name">${streamer.name}</div>
                    <div class="tab-viewers">
                        <i class="fas fa-users"></i>
                        <span>${formatViewers(streamer.viewers)}</span>
                    </div>
                    <button class="tab-watch-btn">
                        <i class="fas fa-play"></i> Watch
                    </button>
                `;
                tab.addEventListener('click', (e) => {
                    if (e.target.closest('.tab-watch-btn')) {
                        selectStream(streamer);
                        document.querySelectorAll('.simple-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            } else {
                tab.innerHTML = `
                    <img src="${streamer.avatar}" alt="${streamer.name}" class="tab-avatar offline">
                    <div class="tab-name">${streamer.name}</div>
                    <div class="tab-viewers" style="color: var(--red-500);">
                        <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 4px;"></i>
                        <span>Offline</span>
                    </div>
                    <button class="tab-watch-btn" style="background: var(--gray-600);">
                        <i class="fas fa-eye"></i> Ver canal
                    </button>
                `;
                tab.addEventListener('click', (e) => {
                    if (e.target.closest('.tab-watch-btn')) {
                        window.open(`https://kick.com/${streamer.name}`, '_blank');
                    } else {
                        selectOfflineStream(streamer);
                        document.querySelectorAll('.simple-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            }
            tabsBelowVideo.appendChild(tab);
        });
    }

    function setVerifiedBadge(isVerified) {
        const badgeContainer = verifiedBadge;
        badgeContainer.innerHTML = '';
        if (isVerified) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(KICK_VERIFIED_SVG, "image/svg+xml");
            const svg = doc.documentElement;
            svg.classList.add("verified-icon");
            badgeContainer.appendChild(svg);
            badgeContainer.style.display = 'inline-flex';
            badgeContainer.style.marginLeft = '-4px';
            badgeContainer.style.verticalAlign = 'middle';
        } else {
            badgeContainer.style.display = 'none';
        }
    }

    function selectStream(streamer) {
    currentStreamer = streamer;

    // ✅ Ocultar placeholder y botón central inmediatamente
    videoPlaceholder.style.display = 'none';
    if (centerPlay) centerPlay.classList.add('hide');

    // ✅ Eliminar banner offline si existe
    const offlineBanner = document.querySelector('.offline-banner-layer');
    if (offlineBanner) offlineBanner.remove();

    // Mostrar el video
    videoPlayer.style.display = 'block';

    // Actualizar metadatos del stream
    channelAvatar.src = streamer.avatar;
    channelAvatar.className = 'channel-avatar';
    channelName.textContent = streamer.name;
    streamTitleNew.textContent = streamer.streamTitle;
    streamCategoryNew.textContent = streamer.category;
    streamViewersNew.textContent = formatViewers(streamer.viewers);
    partnerBadgeNew.style.display = streamer.isPartner ? 'flex' : 'none';
    setVerifiedBadge(streamer.isVerified);

    // Tags
    tagsContainer.innerHTML = '';
    streamer.tags.forEach(tag => {
        const el = document.createElement('span');
        el.className = 'tag';
        el.textContent = tag;
        tagsContainer.appendChild(el);
    });

    // Cargar y reproducir
    loadVideo(streamer.videoUrl);

    // ✅ Intentar reproducir tras una pequeña demora (para asegurar que el src esté listo)
    setTimeout(() => {
        const playPromise = videoPlayer.play();
        if (playPromise !== undefined) {
            playPromise.catch(() => {
                // Silencioso o log opcional: muchos navegadores bloquean autoplay sin interacción
            });
        }
    }, 300);

    // UI
    document.getElementById('viewersInfoContainer').style.display = 'flex';
    document.querySelector('.category-section').style.marginBottom = '';
    document.getElementById('liveBadgeStream').style.display = 'block';
}

    // --- STREAM OFFLINE ---
function selectOfflineStream(streamer) {
    currentStreamer = streamer;

    // ✅ Detener y limpiar el video
    videoPlayer.pause();
    videoPlayer.src = "";
    videoPlayer.load();
    videoPlayer.style.display = 'none';

    // ✅ OCULTAR EL BOTÓN CENTRAL SIEMPRE EN OFFLINE    
    centerPlay.style.display = "none";

    // ✅ Añadir banner offline como capa superpuesta
    const videoContainer = document.querySelector('.video-container');
    const defaultBanner = "https://kick.com/img/default-channel-banners/offline.webp";
    let bannerUrl = defaultBanner;
    if (streamer.offlineBanner) {
        if (streamer.offlineBanner.includes("/conversion/")) {
            bannerUrl = streamer.offlineBanner
                .replace("/conversion/", "/responsives/")
                .replace("-fullsize.jpg", "___fullsize_702_395.webp");
        } else {
            bannerUrl = streamer.offlineBanner;
        }
    }

    // Crear o actualizar la capa de banner
    let offlineBanner = videoContainer.querySelector('.offline-banner-layer');
    if (!offlineBanner) {
        offlineBanner = document.createElement('img');
        offlineBanner.className = 'offline-banner-layer';
        offlineBanner.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        `;
        videoContainer.appendChild(offlineBanner);
    }
    offlineBanner.src = bannerUrl;

    // Actualizar datos offline
    channelAvatar.src = streamer.avatar;
    channelAvatar.className = 'channel-avatar offline'; // añade la clase offline
    channelName.textContent = streamer.name;
    partnerBadgeNew.style.display = streamer.isPartner ? 'flex' : 'none';
    setVerifiedBadge(streamer.isVerified);
    streamTitleNew.textContent = `${formatFollowers(streamer.followers)} seguidores`;
    streamCategoryNew.textContent = `Última vez en vivo ${streamer.lastLiveText}`;

    // Ocultar viewers y tags
    document.getElementById('viewersInfoContainer').style.display = 'none';
    document.querySelector('.category-section').style.marginBottom = '0';
    tagsContainer.innerHTML = '';

document.getElementById('liveBadgeStream').style.display = 'none';
}

    // --- NUEVO REPRODUCTOR FUNCIONALIDAD ---
    function addClickHandler(element, handler) {
        element.addEventListener("click", handler);
        if ('ontouchstart' in window) {
            element.addEventListener("touchstart", (e) => {
                e.preventDefault();
                e.stopPropagation();
                handler(e);
            }, { passive: false });
        }
    }

    function showControls() {
        const videoControls = document.querySelector('.video-controls');
        videoControls.classList.add('user-interacted');
    }

    function clamp01(v) {
        return Math.max(0, Math.min(1, v));
    }

    function formatTime(seconds) {
        if (isNaN(seconds) || !isFinite(seconds)) return "0:00";
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, "0")}`;
    }

    function getLabelFromHeight(height) {
        if (height >= 2160) return "2160p";
        if (height >= 1440) return "1440p";
        if (height >= 1080) return "1080p";
        if (height >= 720)  return "720p";
        if (height >= 480)  return "480p";
        if (height >= 360)  return "360p";
        if (height >= 240)  return "240p";
        return `${height}p`;
    }

    function isLiveStream() {
        return isLiveDetected;
    }

    function updateProgressRAF() {
        if (isLiveStream()) {
            rafId = requestAnimationFrame(updateProgressRAF);
            return;
        }

        if (isFinite(videoPlayer.duration) && videoPlayer.duration > 0) {
            const percent = videoPlayer.currentTime / videoPlayer.duration;
            progressBar.style.width = `${percent * 100}%`;
            thumb.style.left = `${percent * 100}%`;
        }
        rafId = requestAnimationFrame(updateProgressRAF);
    }

    function updateBuffer() {
        if (isLiveStream()) return;
        if (videoPlayer.buffered.length > 0 && videoPlayer.duration > 0) {
            const bufferedEnd = videoPlayer.buffered.end(videoPlayer.buffered.length - 1);
            const percent = clamp01(bufferedEnd / videoPlayer.duration);
            bufferBar.style.width = `${percent * 100}%`;
        }
    }

    let thumbTimeout = null;
    let previewTimeout = null;

    function showThumbTemporarily() {
        if (isLiveStream()) return;
        thumb.style.opacity = "1";
        if (thumbTimeout) clearTimeout(thumbTimeout);
        thumbTimeout = setTimeout(() => {
            thumb.style.opacity = "0";
        }, 500);
    }

    function showPreview(percent) {
        if (isLiveStream()) return;
        const p = clamp01(percent);
        previewTime.textContent = formatTime(p * (videoPlayer.duration || 0));
        previewTime.style.left = `${p * 100}%`;
        previewTime.style.opacity = "1";
        if (previewTimeout) clearTimeout(previewTimeout);
        previewTimeout = setTimeout(() => {
            previewTime.style.opacity = "0";
        }, 500);
    }

    function loadVideo(src) {
        if (hls) {
            hls.destroy();
            hls = null;
        }
        const isM3u8 = src.toLowerCase().includes(".m3u8");

        if (isM3u8 && window.Hls && Hls.isSupported()) {
            hls = new Hls({ enableWorker: true, liveSyncDurationCount: 3 });
            hls.loadSource(src);
            hls.attachMedia(videoPlayer);

            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                if (hls.levels && hls.levels.length > 0) {
                    const hasResolution = hls.levels.some(level => level.height > 0);
                    isLiveDetected = !hasResolution;
                } else {
                    isLiveDetected = true;
                }
                updateTime();
                updateDetectedQuality();
                populateQualityMenu();
            });

            hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
                const level = hls.levels[data.level];
                if (level && level.height) {
                    qualityBadge.textContent = getLabelFromHeight(level.height);
                }
            });

            hls.on(Hls.Events.LEVEL_UPDATED, updateTime);
            hls.on(Hls.Events.FRAG_LOADED, updateTime);
            hls.on(Hls.Events.ERROR, (event, data) => {
                console.warn("Hls error:", data);
            });
        } else if (isM3u8 && videoPlayer.canPlayType("application/vnd.apple.mpegurl")) {
            videoPlayer.src = src;
            isLiveDetected = false;
        } else {
            videoPlayer.src = src;
            isLiveDetected = false;
        }
    }

    function updateDetectedQuality() {
        if (videoPlayer.videoHeight > 0) {
            const label = getLabelFromHeight(videoPlayer.videoHeight);
            qualityBadge.textContent = label;
        }
    }

    function populateQualityMenu() {
        const container = settingsDropdown.querySelector('.settings-title').parentElement;
        while (container.children.length > 1) {
            container.removeChild(container.lastChild);
        }

        const allowedHeights = [1080, 720, 480];
        let currentLabel = "Desconocido";

        if (hls && hls.levels && hls.levels.length > 0) {
            const hasResolutionMetadata = hls.levels.some(level => level.height > 0);

            if (hasResolutionMetadata) {
                const validLevels = hls.levels
                    .map((level, idx) => ({ ...level, originalIndex: idx }))
                    .filter(l => l.height && allowedHeights.includes(l.height))
                    .sort((a, b) => {
                        const aPos = allowedHeights.indexOf(a.height);
                        const bPos = allowedHeights.indexOf(b.height);
                        return aPos - bPos;
                    });

                if (validLevels.length === 0) {
                    const allWithHeight = hls.levels
                        .map((l, i) => ({ ...l, originalIndex: i }))
                        .filter(l => l.height);
                    if (allWithHeight.length > 0) {
                        allWithHeight.sort((a, b) => {
                            const aDiff = Math.min(...allowedHeights.map(h => Math.abs(h - a.height)));
                            const bDiff = Math.min(...allowedHeights.map(h => Math.abs(h - b.height)));
                            return aDiff - bDiff;
                        });
                        validLevels.push(allWithHeight[0]);
                    }
                }

                validLevels.forEach(level => {
                    const label = getLabelFromHeight(level.height);
                    const option = document.createElement("div");
                    option.className = "quality-option";
                    option.dataset.quality = label;
                    option.dataset.levelIndex = level.originalIndex;
                    option.textContent = label;

                    option.addEventListener("click", () => {
                        hls.currentLevel = parseInt(level.originalIndex);
                        qualityBadge.textContent = label;
                        document.querySelectorAll(".quality-option").forEach(o => o.classList.remove("active"));
                        option.classList.add("active");
                        settingsDropdown.classList.remove("active");
                        settingsOpen = false;
                    });

                    container.appendChild(option);
                });

                const currentLevel = hls.levels[hls.currentLevel !== -1 ? hls.currentLevel : 0];
                currentLabel = currentLevel && currentLevel.height
                    ? getLabelFromHeight(currentLevel.height)
                    : (validLevels[0] ? getLabelFromHeight(validLevels[0].height) : "Auto");

            } else {
                const detectedHeight = videoPlayer.videoHeight;
                currentLabel = detectedHeight > 0 ? getLabelFromHeight(detectedHeight) : "0p";
                const option = document.createElement("div");
                option.className = "quality-option";
                option.textContent = currentLabel;
                option.style.pointerEvents = "none";
                option.style.color = "var(--gray-400)";
                container.appendChild(option);
            }
        } else {
            const detectedHeight = videoPlayer.videoHeight;
            currentLabel = detectedHeight > 0 ? getLabelFromHeight(detectedHeight) : "0p";
            const option = document.createElement("div");
            option.className = "quality-option";
            option.textContent = currentLabel;
            option.style.pointerEvents = "none";
            option.style.color = "var(--gray-400)";
            container.appendChild(option);
        }

        qualityBadge.textContent = currentLabel;
        document.querySelectorAll(".quality-option").forEach(opt => {
            if (opt.dataset.quality === currentLabel) {
                opt.classList.add("active");
            }
        });
    }

    function updateTime() {
        if (isLiveStream() && videoPlayer.seekable && videoPlayer.seekable.length > 0) {
            const liveEdge = videoPlayer.seekable.end(videoPlayer.seekable.length - 1);
            const lag = liveEdge - videoPlayer.currentTime;
            const THRESHOLD = 30;

            if (lag <= THRESHOLD) {
                timeDisplay.textContent = "LIVE";
                timeDisplay.classList.add("time-live");
                progressBar.style.width = "100%";
                liveBadge.style.display = "flex";
                goLiveBtn.style.display = "none";
            } else {
                timeDisplay.textContent = `${formatTime(videoPlayer.currentTime)} / ${formatTime(liveEdge)}`;
                timeDisplay.classList.remove("time-live");
                progressBar.style.width = `${(videoPlayer.currentTime / liveEdge) * 100}%`;
                liveBadge.style.display = "none";
                goLiveBtn.style.display = "block";
            }
        } else {
            const dur = isFinite(videoPlayer.duration) ? videoPlayer.duration : 0;
            timeDisplay.textContent = `${formatTime(videoPlayer.currentTime)} / ${formatTime(dur)}`;
            timeDisplay.classList.remove("time-live");

            if (dur > 0) {
                progressBar.style.width = `${(videoPlayer.currentTime / dur) * 100}%`;
            } else {
                progressBar.style.width = "0%";
            }

            liveBadge.style.display = "none";
            goLiveBtn.style.display = "none";
        }
    }

    addClickHandler(goLiveBtn, () => {
        if (videoPlayer.seekable && videoPlayer.seekable.length > 0) {
            const liveEdge = videoPlayer.seekable.end(videoPlayer.seekable.length - 1);
            videoPlayer.currentTime = liveEdge - 0.05;
            const p = videoPlayer.play();
            if (p && p.catch) p.catch(() => {});
            goLiveBtn.style.display = "none";
        }
        showControls();
    });

    videoPlayer.addEventListener("play", () => {
        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
        if (centerPlay) centerPlay.classList.add("hide");
    });

    videoPlayer.addEventListener("pause", () => {
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        if (videoPlayer.currentTime === 0 && centerPlay) centerPlay.classList.remove("hide");
    });

    if (centerPlay) centerPlay.addEventListener("click", () => videoPlayer.play());

    videoPlayer.addEventListener("loadedmetadata", () => {
        updateDetectedQuality();
        updateTime();
        setTimeout(() => populateQualityMenu(), 100);
        setTimeout(updateTime, 500);
        setTimeout(updateTime, 1500);
    });

    videoPlayer.addEventListener("loadeddata", () => {
        updateDetectedQuality();
        populateQualityMenu();
    });

    videoPlayer.addEventListener("resize", updateDetectedQuality);
    setInterval(updateDetectedQuality, 5000);

    videoPlayer.addEventListener("progress", updateBuffer);
    videoPlayer.addEventListener("timeupdate", updateTime);
    videoPlayer.addEventListener("seeked", updateTime);

    videoPlayer.addEventListener("waiting", () => {
        loadingSpinner.style.display = "block";
    });

    videoPlayer.addEventListener("playing", () => {
        loadingSpinner.style.display = "none";
    });

    videoPlayer.addEventListener("loadstart", () => {
        loadingSpinner.style.display = "block";
    });

    videoPlayer.addEventListener("error", () => {
        loadingSpinner.style.display = "none";
    });

    function handleProgressInteraction(clientX) {
        if (isLiveStream()) return;

        const rect = progressContainer.getBoundingClientRect();
        const percent = clamp01((clientX - rect.left) / rect.width);
        const newTime = percent * (videoPlayer.duration || 0);

        progressBar.style.width = `${percent * 100}%`;
        thumb.style.left = `${percent * 100}%`;
        timeDisplay.textContent = `${formatTime(newTime)} / ${formatTime(videoPlayer.duration)}`;
        showThumbTemporarily();
        showPreview(percent);

        if (isFinite(videoPlayer.duration) && videoPlayer.duration > 0) {
            videoPlayer.currentTime = newTime;
        }
    }

    progressContainer.addEventListener("click", (e) => {
        handleProgressInteraction(e.clientX);
    });

    progressContainer.addEventListener("mousemove", (e) => {
        if (isLiveStream()) return;
        const rect = progressContainer.getBoundingClientRect();
        const percent = clamp01((e.clientX - rect.left) / rect.width);
        thumb.style.left = `${percent * 100}%`;
        showThumbTemporarily();
        showPreview(percent);
    });

    progressContainer.addEventListener("mouseleave", () => {
        if (isLiveStream()) return;
        if (thumbTimeout) clearTimeout(thumbTimeout);
        if (previewTimeout) clearTimeout(previewTimeout);
        thumb.style.opacity = "0";
        previewTime.style.opacity = "0";
    });

    const isTouchDevice = 'ontouchstart' in window;
    if (isTouchDevice) {
        const handleTouch = (e) => {
            e.preventDefault();
            const touch = e.touches[0] || e.changedTouches[0];
            handleProgressInteraction(touch.clientX);
        };
        progressContainer.addEventListener('touchstart', handleTouch, { passive: false });
        progressContainer.addEventListener('touchmove', handleTouch, { passive: false });
    }

    videoWrapper.addEventListener('dblclick', () => {
        if (!document.fullscreenElement) {
            videoWrapper.requestFullscreen();
        } else {
            document.exitFullscreen();
        }
    });

    addClickHandler(playBtn, () => {
        videoPlayer.paused ? videoPlayer.play() : videoPlayer.pause();
        showControls();
    });

    addClickHandler(muteBtn, handleMuteClick);

    function handleMuteClick() {
        videoPlayer.muted = !videoPlayer.muted;
        muteBtn.innerHTML = videoPlayer.muted
            ? '<i class="fas fa-volume-mute"></i>'
            : '<i class="fas fa-volume-up"></i>';
        volumeSlider.value = videoPlayer.muted ? 0 : videoPlayer.volume;

        const isTouch = 'ontouchstart' in window;
        if (isTouch) {
            volumeContainer.classList.add('open');
        }
        showControls();
    }

    if ('ontouchstart' in window) {
        document.addEventListener('touchstart', (e) => {
            if (!volumeContainer.contains(e.target)) {
                volumeContainer.classList.remove('open');
            }
        });
    }

    volumeSlider.addEventListener("input", (e) => {
        videoPlayer.volume = e.target.value;
        videoPlayer.muted = (videoPlayer.volume === 0);
        muteBtn.innerHTML = videoPlayer.muted
            ? '<i class="fas fa-volume-mute"></i>'
            : '<i class="fas fa-volume-up"></i>';
    });

    addClickHandler(fullscreenBtn, () => {
        if (!document.fullscreenElement) {
            videoWrapper.requestFullscreen();
        } else {
            document.exitFullscreen();
        }
        showControls();
    });

    document.addEventListener("fullscreenchange", () => {
        fullscreenBtn.innerHTML = document.fullscreenElement
            ? '<i class="fas fa-compress"></i>'
            : '<i class="fas fa-expand"></i>';
        settingsDropdown.classList.remove("active");
        settingsOpen = false;
    });

    let settingsOpen = false;
    addClickHandler(settingsBtn, () => {
        settingsOpen = !settingsOpen;
        settingsDropdown.classList.toggle("active", settingsOpen);
        showControls();
    });

    videoWrapper.addEventListener("mouseleave", () => {
        settingsDropdown.classList.remove("active");
        settingsOpen = false;
    });

    const videoControls = document.querySelector('.video-controls');
    videoWrapper.addEventListener('mouseleave', () => {
        videoControls.classList.remove('user-interacted');
    });

    if ('ontouchstart' in window) {
        document.addEventListener('touchstart', (e) => {
            if (!videoWrapper.contains(e.target)) {
                videoControls.classList.remove('user-interacted');
            }
        });
    }

    // --- ACTUALIZAR STREAM ACTUAL ---
    async function updateCurrentStreamerData() {
        if (!currentStreamer || !currentStreamer.isLive) return;
        try {
            const res = await fetch(`https://kick.com/api/v2/channels/${currentStreamer.name}`);
            if (!res.ok) return;
            const data = await res.json();
            if (data.livestream?.is_live) {
                streamViewersNew.textContent = formatViewers(data.livestream.viewer_count || 0);
                streamTitleNew.textContent = data.livestream.session_title || currentStreamer.streamTitle;
            }
        } catch (e) {
            console.warn("No se pudo actualizar el stream actual:", e);
        }
    }

    // --- INICIALIZAR ---
    function init() {
        renderTabsBelowVideo();
        requestAnimationFrame(updateProgressRAF);
        setInterval(renderTabsBelowVideo, 300000);
        setInterval(updateCurrentStreamerData, 10000);
    }

    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
